
# 基金趋势可视化与持仓管理工具

一款交互式的 Web 应用，旨在帮助用户跟踪、可视化、比较多支投资基金的历史表现，并管理个人持仓信息。

## 部署故障排除 (Troubleshooting)

### 🚨 部署后出现 Tailwind CSS 警告

如果您在 Netlify 或其他平台部署后，控制台显示以下红色警告：
`cdn.tailwindcss.com should not be used in production...`

**解释**:
这是一个提示性警告。由于本项目为了保持轻量级和便于在线编辑，直接使用了 Tailwind CSS 的 CDN 版本。在生产环境中，它可能会导致页面加载时的样式闪烁，但在功能上通常不会导致应用崩溃。

**解决方法**:
1.  **无需操作**: 该警告不会影响应用的正常功能，您可以忽略它。
2.  **已自动屏蔽**: 最新版本的代码已在 `index.html` 中添加了脚本来拦截此特定的控制台警告，以保持控制台整洁。

### 🚨 部署后出现白屏 (Blank Screen)

如果您在 Netlify 或其他平台部署后网页显示一片空白，通常是因为**环境变量缺失**导致构建出的代码在浏览器中运行时报错。

**原因**: 
项目依赖 `GEMINI_API_KEY`。如果构建时未找到该变量，Vite 默认可能会将代码中的 `process.env.API_KEY` 保留，而浏览器无法识别 `process` 对象，导致 `ReferenceError: process is not defined` 错误，应用崩溃。

**解决方法**:

1.  **配置环境变量**:
    *   登录 **Netlify** 控制台。
    *   进入 **Site Settings** > **Environment variables**。
    *   添加变量:
        *   Key: `GEMINI_API_KEY`
        *   Value: `您的_Google_Gemini_API_Key` (如果没有，可以填任意非空字符串以恢复页面显示，但 AI 功能将不可用)。
    *   **重新部署 (Trigger Deploy)** 以应用更改。

2.  **代码层面的修复 (已包含)**:
    *   最新代码已在 `vite.config.ts` 中添加了安全回退逻辑 (`|| ''`)，确保即使未配置环境变量，应用也能正常加载（白屏问题已修复），仅 AI 智能投顾功能会提示错误。

### ✅ 微信域名归属验证

已添加微信验证文件 `923933dc37a6e22bac3d6b877c4e1bc6.txt` 至 `public` 目录。
Vite 构建时会自动将其复制到站点根目录，满足微信“将验证文件部署在网站根目录下”的要求。

## 核心功能

- **[核心] 智能推荐评分系统 (Smart Opportunity Score)**:
    - 系统采用一套独特的**多因子加权算法**，为您提供量化的买卖建议。
    - **评分公式**: $$ Score = (50\% \times 估值分) + (30\% \times 趋势分) + (20\% \times 今日分) $$
    - **1. 估值分 (权重 50%)**:
        - 核心逻辑：**便宜就是硬道理**。基于历史净值分位点计算，分位点越低，得分越高。
    - **2. 趋势分 (权重 30%) - M型双峰逻辑**:
        - **超跌区 (R < -3%)**: **高分**。跌幅越深得分越高（左侧抄底逻辑）。
        - **磨底区 (-3%~0%)**: **中性**。约50分，观望为主。
        - **爬坡区 (0%~4.5%)**: **上升**。得分随涨幅线性增加。
        - **甜蜜区 (4.5%~9%)**: **满分**。确认为主升浪，最适合右侧追涨。
        - **过热区 (R > 9%)**: **极速扣分**。涨幅过大风险激增，得分断崖式下跌，提示减仓风险。
    - **3. 今日分 (权重 20%) - 情境感知**:
        - 系统会根据当前趋势方向自动调整评价标准：
        - **下跌趋势中**: 今日**下跌**得分更高（给机会接飞刀）。
        - **上涨趋势中**: 今日**上涨**得分更高（确认强势，拒绝假突破）。
    - **可视化决策 (5级评级)**:
        - **🔴 强力买入 (Score ≥ 75)**: 极高性价比，完美的左侧深跌或右侧主升浪。
        - **🟠 建议买入 (60 ≤ Score < 75)**: 性价比不错，虽有瑕疵（如估值稍高或趋势刚起步），但值得介入。
        - **⚪️ 持有/观望 (40 ≤ Score < 60)**: 鸡肋区间，多看少动。
        - **🔵 建议减仓 (25 ≤ Score < 40)**: 风险开始积聚，建议分批止盈或减仓。
        - **🟢 强力卖出 (Score < 25)**: 极度危险，严重过热或严重高估。
        - **列表展示**: 评分结果直接显示在基金名称下方，格式如：`🔴 评分: 78 强力买入 (超跌)`，简洁直观。
        - **排序与筛选**: 
            - 在控制栏的排序下拉框中选择“**智能评分**”，快速找到最值得买或最该卖的标的。
            - 在筛选下拉框中，您可以直接选择上述5个评级标签，快速过滤出对应状态的基金。

- **[新优化] 界面交互体验升级**:
    - **背景滚动锁定**: 全面优化了模态框和隐私遮罩的交互体验。现在，当打开任何弹窗（如基金详情、交易、导入、Terminal、切片分析详情）或触发隐私遮罩时，**背景页面会自动锁定**，禁止滚动。这消除了在操作弹窗时意外滚动到底层内容的困扰，使操作更加聚焦和流畅。
    - **鼠标光标统一样式**: 为提升界面的专业性和一致性，移除了大量元素上的手动“小手”光标 (`cursor-pointer`) 样式，使鼠标行为回归浏览器默认的箭头样式，仅保留加载状态的等待光标。
- **[新优化] 列表显示增强**:
    - **定长持仓权重条**: 在基金列表的名称下方，新增了**固定长度的持仓权重进度条**。进度条采用左右布局，左侧显示进度与排名，右侧独立显示持仓金额。这一设计确保了进度条的视觉一致性，不再受金额尾数长短的影响，使权重分布一目了然且整洁美观。
    - **持仓权重可视化**: 进度条直观地展示了该基金占**当前筛选结果**总市值的百分比。
    - **排名与取整显示**: 进度条旁会显示该基金在当前列表中的**市值排名**（如 #1）及具体百分比，金额显示优化为**取整**后的千分位格式。
- **[新优化] 导入界面布局调整**:
    - 优化了数据导入弹窗的布局，将 Gist 同步操作按钮整合至左侧，使输入区域更加紧凑聚焦。
- **[新优化] 实时数据高并发加载**:
    - 移除了旧版本中的串行请求锁，采用**全局 JSONP 路由模式**。现在，所有基金的实时估值请求（`fetchFundDetails`）均并行发出，不再需要排队等待。
    - 在 20+ 只基金的列表加载场景下，初始化速度提升显著。
    - **健壮的缓存兜底策略**: 优化了数据容错逻辑。当某个基金的实时估值接口（Primary API）请求失败时，系统会**优先检查并展示内存中的旧缓存数据**，而不是直接跳转到降级接口返回空白数据（导致界面显示 "-"）。只有在既无新数据也无旧缓存时，才会使用降级接口获取基础名称。
- **[新功能] "近期有交易" 智能筛选与指示**:
    - **智能筛选**: 在控制栏的筛选下拉框中新增了“**近期有交易**”选项。
        - **动态定义“近期”**: 过滤器不是简单的固定天数，而是智能关联每只基金当前的 **Zigzag 趋势周期**。
        - **逻辑**: 如果一只基金在当前的趋势波段内（从最近一次趋势拐点至今）有过任何买入或卖出操作，该基金就会被筛选出来。
    - **可视化指示**: 在**标签分析表格**中，如果某个标签分组（或全局总计）下的基金在近期趋势内有交易，其“**近期收益率**”列的百分比数值前会自动显示一个**黑色实心圆点 (●)**。这让您在查看宏观分组时，能一眼识别出哪些板块最近有过操作动作。
    - **UI 细节优化**: 标签分析表格的“近期收益率”列在趋势显著（深跌或温和上涨）时会显示灰色背景。我们优化了该背景的逻辑，确保它在**鼠标悬停**或**行选中**时能够自动消退，从而让用户清晰地看到交互反馈。
- **[新功能] Terminal 极客终端**:
    - **极客风格交互**: 新增内置 Terminal，提供类似命令行的交互体验。
    - **`trade` 交易指令**: 支持通过命令行快速执行买卖操作，支持批量操作。
        - 语法: `trade <action> <targets> <value> [date]`
        - 示例: `trade buy 001234 1000` (今日买入 001234 基金 1000元)
        - 示例: `trade sell all 50%` (卖出所有持仓的 50%)
    - **`inspect` 历史回溯**: 强大的“时光机”功能，可查看任意历史日期的持仓状态和基金数据矩阵。
        - 语法: `inspect <date>` (e.g., `inspect 2023-10-27`)
        - **无未来函数**: 严谨的数据切片逻辑，计算趋势和分位点时绝不引用当日之后的任何数据。
        - **数据矩阵**: 输出包含当日净值、当日涨跌、近期趋势、分位点以及用户设定范围（如100天）的历史数据的宽表。
- **[新功能] Gemini 智能投顾**:
    - 集成 Google Gemini 2.5 Flash 模型，基于您的实时持仓、历史交易、Zigzag 趋势拐点、净值分位点及操作切片数据，为您提供智能化的操作建议。
    - **全数据上下文**: 每次分析时，AI 都会接收每一只基金的**完整历史净值数据**（包括历史涨跌幅）以及**今日实时涨跌幅**。这使得 AI 能够像人类分析师一样“阅读”K线图，识别形态和波动趋势。
    - **内置 4.5% 金字塔策略**: AI 已深度集成了您的交易策略。在每次分析时，会自动计算基金当前净值相对于上一次买入价格的跌幅。如果跌幅达到 **-4.5%**（加仓1倍）、**-9%**（加仓2倍）或 **-13.5%**（加仓4倍），AI 将明确提示您执行加仓操作。
    - **透明化提示词 (Debug Mode)**: 每次生成建议时，发送给 LLM 的完整 Prompt（提示词）都会输出到浏览器的控制台 (Console) 中，方便您查看 AI 做出判断的依据。
    - **目标导向**: 分析的核心目标是最大化“操作收益”（捕获波动）和“造成盈亏”（提升日盈利能力）。
    - **全维度分析**: 自动结合大盘指数（上证指数）、个股趋势状态和估值水平，给出买入、卖出或持有的具体建议。
    - **入口便捷**: 点击控制栏中的紫色星光图标即可唤起 AI 顾问。
- **交互式交易日志 (Trading Journal)**:
    - **统一的交易流水**: 您的所有交易——无论是**已确认**的历史记录，还是**待处理**的当日操作——都会被统一记录在基金的交易流水中。这使得通过 JSON 导入/导出功能可以**完整地同步您所有的交易状态**。
    - **可视化交易历史**: 您的每一笔**已确认**的买卖操作都会在基金的**净值走势图**上以一个醒目的**红点 (买入)** 或**蓝点 (卖出)** 进行标记。将鼠标悬停在这些点上，可以立刻看到该笔交易的详细信息（如成交净值、金额/份额），让您的操作与市场波动之间的关系一一目了然。
    - **上下文驱动的交易与编辑**:
        - 在主数据表的**每一个日期单元格**内，都提供了交易入口。一旦您在某日进行了交易（无论是已确认的还是待处理的），该单元格的“买/卖”链接会自动合并成一个“**记录**”按钮，同时单元格背景会根据交易类型变为**浅红色 (买入)** 或**浅蓝色 (卖出)**，为您提供清晰、即时的视觉反馈。如果该日恰好是趋势拐点，背景色会进一步加深。
        - 对于**已确认**的交易，点击“记录”按钮会打开一个**预填充了该笔交易数据**的弹窗，您可以在此**查看**、**修改**或**删除**这笔历史交易。
        - 对于**待处理**的操作，点击“记录”按钮同样会打开一个编辑弹窗，您可以在此**修改**交易的金额/份额，或直接**删除**该笔待处理记录。
    - **智能执行逻辑**:
        - **补录历史 (即时成交)**: 点击任意**历史日期**的买卖按钮，交易将作为一笔**已确认记录**被立即计算并生效。
        - **当日交易 (自动处理)**: 点击**“当日净值”**列的买卖按钮，系统会自动判断：若净值**已确认**，则**立即成交**；若**未确认**，则为您创建一笔**待处理的交易记录**，该记录将在净值更新后自动转换为已确认记录。
    - **健壮的数据一致性**:
        - 每当您修改或删除**任何一笔历史交易**，或在详情弹窗中更新您的**初始持仓**时，系统都会在后台启动一个“**顺序重算 (Replay)**”机制。它会从零开始，按时间顺序重新计算您的每一笔**已确认**交易，以确保您当前的份额、平均成本和累计收益等所有财务数据都保持绝对的准确性。
    - **独立的交易弹窗**: “买入”和“卖出”拥有各自独立的、经过优化的弹窗界面，并内嵌了分析图表，支持您在交易前快速回顾近期表现和进行实时预估。所有金额输入框均支持小数点后两位，并优化了回车提交的体验，避免了不必要的浏览器原生校验错误。
- **持仓管理**:
    - **数据录入与计算精度**: 在基金详情弹窗中，您可以方便地录入和编辑您的持仓份额、平均成本价、累计收益和自定义标签。为了确保财务数据的严谨性，整个应用遵循统一的精度标准：所有**金额**相关数据（如成本、收益、市值）精确到 **2 位小数**；**份额**精确到 **2 位小数**；而**单位净值/成本价**则精确到 **4 位小数**。这一标准不仅应用于数据输入，也贯穿于所有的内部计算和数据存储环节。
    - **收益计算**: 应用会自动根据您的持仓数据和最新的基金净值，计算出您的估算总值、持有成本、持有收益、累计收益、今日预估收益等多项核心指标。
    - **智能成本展示**: 在图表和表单中，当您的“实际成本”（考虑了已实现收益后）与原始“持仓成本”相同时，界面会自动隐藏“实际成本”的相关显示，避免信息冗余，使界面更整洁。
    - **数据导入/导出与 Gist 同步**: 
        - **本地导入**: 支持通过粘贴 JSON 字符串来恢复持仓数据。系统兼容新旧版本数据格式，并能自动识别。
        - **[新功能] GitHub Gist 同步**: 集成了 GitHub Gist 功能，实现多设备间的数据云同步。
            - **Token 配置**: 通过 URL 参数传递 Token，例如 `https://ginosfunds.netlify.app/?token=YOUR_GITHUB_TOKEN`。应用检测到参数后会自动将其保存至本地存储。
            - **拉取 (Pull)**: 本地存有 Token 且**未开启自动同步**时显示。点击导入弹窗中的下载图标，可从指定的 Gist 地址拉取最新的持仓数据。
            - **同步 (Push)**: 本地存有 Token 且**已开启自动同步**时显示。点击导入弹窗中的上传图标，可将当前的持仓数据上传并覆盖到远程 Gist。
            - **自动同步 (Auto Sync)**: 新增自动同步功能。当本地配置了 Token 且开启此开关后，按钮显示“同步: 主”，任何交易操作（买入/卖出）触发的持仓数据变更，都会自动同步推送到 Gist，实现无感云备份；关闭时显示“同步: 从”，仅作为数据查看端。
            - **启动自动拉取 (Pull on Start)**: 若配置了 Token 但**未开启自动同步**，应用启动时会自动尝试从 Gist 拉取最新数据并覆盖本地，确保在多端切换且不使用自动同步时也能获取最新进度。若拉取失败（如离线），则降级使用本地缓存数据。
        - **复制外部格式 JSON**: 为了方便与其他系统集成，提供了一键复制特定格式 JSON 的功能。
    - **数据持久化**: 您的所有持仓信息都会安全地保存在浏览器的本地存储（Local Storage）中，下次访问时将自动加载。
    - **智能数据一致性**: 当您在详情弹窗中修改持仓信息时，系统会智能判断：
        - 如果您**只修改了标签或累计收益**，系统会保留您所有的历史交易记录，确保您的交易日志不丢失。
        - 如果您修改了**份额或成本价**，系统会认为您在重置该项持仓的基准，此时会清空旧的交易记录，以新的份额和成本作为起点。这一设计确保了数据在各种编辑场景下的逻辑自洽和准确性。
    - **交易历史回顾**: 在基金详情弹窗中，新增了一个清晰的“**交易历史**”列表。它会按时间倒序展示该基金的**每一笔**买入和卖出记录，包括成交日期、类型、净值、份额变化、交易金额和该笔操作实现的落袋收益。这为您在调整持仓前，提供了一个完整、便捷的历史操作回顾。
- **隐私模式**:
    - **一键隐藏**: 应用内置了隐私模式。
    - **智能默认状态**: 系统通过 UserAgent 智能识别设备类型。在 **PC/Mac 端默认开启**隐私模式；在**移动端（iOS/Android）默认关闭**，避免影响正常的触屏操作体验。
    - **触发条件**: 当鼠标移出浏览器窗口、无任何操作（包括鼠标移动和滚动）超过8秒或单击鼠标右键时，会自动显示一个伪装成 Chrome 断网页面的白色遮罩层，瞬间隐藏所有数据。
    - **信息速览与安全保护**: 在遮罩状态下，您的今日预估总盈亏和收益率默认隐藏为`-`，当鼠标移动到遮罩上时才会显示具体数值，移开后再次隐藏。
        - **[新功能] 内部安全超时**: 为了防止窥屏，如果您在遮罩内查看数据时，鼠标停止移动超过 **8秒**，系统会再次自动隐藏所有数据。
        - **[新功能] 联动老板键**: 在 PC 端，如果触发了上述 8秒 安全超时，**或者鼠标移出窗口区域**，系统不仅会隐藏数据，还会同时触发“老板键”，自动尝试唤起 **飞书 (Feishu)** 窗口，确保隐私绝对安全。
    - **实时动态**: 遮罩层还会显示实时的**上证指数**点位、涨跌额及涨跌幅，让您在隐藏个人信息的同时也能快速掌握大盘动态。**双击鼠标左键**会触发一次静默的数据刷新。**全局的自动刷新**也会在后台照常运行，确保遮罩下的数据保持最新。
    - **解除方式**: 在遮罩状态下，只需再次单击鼠标右键即可恢复显示。
    - **老板键 (PC端专属)**: 当在 PC 端触发隐私模式时，如果未在移动设备上，系统会自动尝试跳转至 **飞书 (Feishu)** 应用，实现更彻底的“视窗切换”。
    - **开关控制**: 在底部的基金添加表单区域，您可以随时通过“隐私模式”开关来启用或禁用此功能（即使在数据加载过程中也可操作）。
    - **禁用右键菜单**: 在隐私模式开启期间，浏览器的默认右键菜单会被屏蔽，以确保隐私模式的正常交互。
- **便捷操作**:
    - **一键复制基金代码**: 在主列表中单击基金代码，或在**买入/卖出弹窗**的标题栏单击代码，即可快速将其复制到剪贴板，方便在其他平台查询。复制成功后，代码区域会短暂显示“复制成功”作为反馈。
    - **表单自动清空**: 添加基金成功后，输入表单中的所有字段（基金代码、份额、成本、标签）会自动清空，方便用户连续添加下一支基金。
    - **弹窗快速关闭**: 所有功能弹窗（包括详情、交易、导入等）均支持通过点击遮罩层空白处或按下 ESC键快速关闭，界面更简洁。
- **标签系统与筛选**:
    - **智能标签**: 应用会根据您的持仓情况自动生成“持有”（份额 > 0）、“自选”（份额 = 0）、“盈利”（持仓收益 > 0）和“亏损”（持仓收益 < 0）四个系统标签。
    - **自定义标签**: 您仍然可以为每项持仓添加个性化的自定义标签（支持Emoji）。
    - **快速筛选**: 所有标签（包括系统标签和自定义标签）都会显示在顶部的筛选器中，并可通过双击基金列表中的标签来快速筛选，方便您按不同维度进行分组查看。
- **标签分析表格**: 在主列表上方新增一个功能强大的“标签分析”表格，提供对您投资组合的宏观洞察。该表格会自动汇总您所有**自定义标签**下的基金，并进行深度分析：
    -   **核心指标与布局**: 表格的列经过精心布局，将关联指标分组展示，逻辑清晰。所有列均等宽分布，确保视觉上的平衡与整洁。
        -   **资产构成**: 清晰展示每个标签分类的**总成本**、**估算总值**和**累计总值**。每个单元格不仅显示绝对金额，还用括号附注了该项占投资组合**总额的百分比**，例如 `18,596 (5%)`，让您对各板块的仓位占比一目了然。
        -   **多维度收益分析**: 对**持有**、**累计**、**今日**和**近期**四个时间维度，都提供了“三位一体”的分析矩阵：
            1.  **收益额**: 绝对的收益金额及其对**总收益的贡献占比**。为了在整体亏损时正确衡量贡献度（例如，亏得更少也是一种相对贡献），贡献占比的分母会取总收益的**绝对值**进行计算。
            2.  **投资效率**: 独创的效率指标（`收益贡献% / 市值贡献%`）。大于 `1.00x` 的值呈**红色**，代表该板块“跑赢”组合平均水平；小于 `1.00x` 的值呈**绿色**，代表“跑输”。此指标基于前述的贡献度计算，能帮您识别出最高效利用资金的板块。
            3.  **收益率**: 该时间维度下对应的加权收益率。
    -   **数据可视化**: 表格中的每一列都集成了**颜色进度条**。进度条的长度代表了该单元格数值在**本列所有数值中的相对大小**（基于绝对值），颜色则区分正负（红/绿）或效率高低。这使得您无需逐一比较数字，就能快速地、直观地识别出各个标签板块的强弱。
    -   **近期收益率高亮**: 最后一列“近期收益率”会自动检测数据的极端情况。当跌幅超过 -4.5%（深跌）或涨幅在 0% 至 4.5% 之间（温和上涨）时，该单元格会显示浅灰色背景。**优化了交互体验**：当鼠标悬停在这些高亮行上时，背景色会加深（而非变浅），双击选中时高亮会让位于选中态，确保视觉反馈清晰无冲突。
    -   **对自选基金的智能分析**:
        -   **完整核算**: 对于份额为零的“自选观察”基金，表格会正确计入其**累计收益**（即已实现的落袋收益），确保您的投资历史被完整记录和分析。
        -   **智能收益率**: 当一个标签分类下**没有持仓**时（即所有基金份额均为零），其“今日收益率”和“近期收益率”将自动切换为该分类下所有基金的**简单平均收益率**，而非加权平均，为您提供有意义的参考指标。
    -   **全局总览**: 表头部分集成了**全局总计行**，实时显示您各项指标的总和，作为各项分析的基准。其中，“累计收益”会汇总**所有基金（包括已清仓的）**的持有收益与落袋收益之和，以完整反映您的投资历史总回报；而其他指标（如总成本、总市值等）则仅统计当前仍**持有份额**的基金。
    -   **基金计数**: 标签名称后会用括号显示该分类下的**基金数量**，如 `☀️新能源 (3)`。
    -   **专业格式化**: 所有数字列均已右对齐，金额字段增加了千分位分隔符，所有盈亏及效率相关的字段都采用了红绿颜色区分，提供了专业、清晰的财务报表阅读体验。
    -   **交互优化**: 为提升双击筛选的体验，表格内的文字已设置为不可选中状态，防止意外高亮。
    -   **快速筛选与定位**: 双击表格中的任意标签行，不仅会**立即筛选**主列表以仅显示该标签下的基金，还会**自动平滑滚动**页面至主列表的顶部，方便您立刻查看筛选结果。再次双击则会取消筛选。
    -   **核心目的**: 此表格超越了简单的盈亏展示。通过引入**贡献度占比**和**投资效率**这两个核心概念，它能帮助您深度剖析：哪些投资板块不仅在赚钱，而且是**最高效**地利用您的资金在赚钱，从而为您的调仓决策提供强有力的数据支持。
- **持仓切片分析 (Portfolio Snapshot Analysis)**: 在您进行**第一笔交易后**，主列表上方会自动出现一个强大的决策复盘工具，它只在有交易记录可供对比时才会显示。
    -   **基准持仓对比**: 表格的最后一行始终会显示您的“**基准持仓**”表现。它代表了您**所有**基金（**包括已清仓的**）在**未进行任何后续交易**的情况下，从其**初始持仓状态**（初始份额、成本和落袋收益）一直持有至今的表现。这为您所有的交易操作提供了一个最纯粹的“买入并持有”参照基准。
    -   **自动快照**: 每当您在任何一天进行交易操作（买入或卖出）时，系统都会自动为该日创建一个“持仓切片”——即您当日操作完成后的完整投资组合的精确快照。
    -   **动态回溯评估**: 表格中的每一行代表一个历史切片。系统会用**今天最新**的基金净值，去重新评估这个历史持仓组合，计算出如果当初的持仓一直持有至今的各项表现指标。
    -   **决策洞察**: 通过对比不同日期的切片表现，您可以清晰地看到历史上某次关键操作（如一次大额买入或卖出）对您长期收益的真实影响，从而复盘并优化您的投资策略。
    -   **深度操作分析**: 表格新增了四列核心指标，用于量化每次操作的精确影响：
        -   **操作收益**: `总值变动 - 金额变动`。它剥离了您投入或撤出的本金，纯粹衡量了该操作周期内**市场波动**带来的收益。
        -   **每百收益**: `(操作收益 / 金额变动绝对值) * 100`。衡量每100元资金变动带来了多少**市场波动收益**，是评估择时能力的关键指标。
        -   **造成盈亏**: `本行日收益 - 上一行日收益`。它衡量了本次操作使得您整个投资组合的**每日收益能力**增加了多少或减少了多少。
        -   **每百造成**: `(造成盈亏 / 金额变动绝对值) * 100`。衡量每100元资金变动对**每日收益能力**的影响.
        -   **操作效果**: `(造成盈亏 / 上一行日收益的绝对值) * 100%`。衡量本次操作相对于**前一日收益能力**的放大或缩小效应。例如 `+200%` 意味着您的操作使今天的每日收益能力比昨天翻了一倍。
    -   **列显示优化**: 表格中的**“累计总值”**列已升级替换为**“持有收益”**（`当前持有总值 - 历史持仓成本`）。这使得表格能更直观地展示每一份历史持仓如果保留至今，在**今天**所产生的纯粹浮动盈亏，而不再包含落袋收益的混淆。表头的折线图也同步更新为持有收益走势，帮助您更清晰地判断持仓策略的长期盈利能力变化。
    -   **智能进度条缩放**: 表格内的进度条现在采用动态范围计算（基于当前列数据的绝对值最小值到最大值），而非从零开始。这使得在资金体量较大时，微小的数值变化也能在视觉上被清晰地放大和识别。
    -   **请注意**：“基准持仓”行的数据代表了初始状态的快照，因此“金额变动”、“操作收益”等与**增量操作**相关的列在此行将显示为“-”，因为它不参与后续的交易对比。
    -   **交互式详情与筛选**: 
        -   **双击详情**: **双击**表格中的任意一行，会弹出一个窗口，详细展示构成该切片的具体操作。
        -   **长按筛选**: **长按**表格中的任意一行（基准持仓除外）超过 **1秒**，即可触发筛选功能，只显示该切片日期当天进行了交易的基金。这是复盘历史操作的绝佳方式。
        -   **多维汇总**: 弹窗内的“操作明细”表底增加了汇总行，不仅显示买入/卖出的总金额和总收益，还会自动计算并显示这些收益占总交易金额的百分比（如浮盈率、机会收益率），让您的交易效率一目了然。
    -   **数据驱动**: 整个分析过程是动态计算的，不产生任何冗余数据。它完全基于您现有的交易记录，确保了数据的绝对准确性和一致性。
- **多基金跟踪**: 通过基金的6位代码，同时添加和监控多支基金。
- **历史数据可视化**: 
    - 每支基金的历史单位净值（NAV）都以直观的蓝色折线图形式直接在主表格中展示。
    - **交互式图表提示**: 鼠标悬停在任意基金的走势图上时，会显示一个详细的提示框，内容包括当日日期（及距今天数）、日涨跌幅，以及（如果已录入持仓）根据您的份额计算出的当日预估收益。
- **Zigzag 趋势线**: 在图表上叠加一条“骨架”折线，用于识别主要市场趋势，忽略微小波动。可以通过“趋势阈值”输入框自定义其灵敏度。
- **趋势拐点标记线**: 在图表上，会用一条灰色的垂直虚线明确标记出最近一个趋势拐点的具体位置，让“近期趋势”的起点一目了然。
- **近期趋势分析**: 在基金名称下方，会**整合显示当日涨跌幅与近期趋势**。格式为“今日⬆︎/⬇︎X.XX%, 近Y天, ⬆︎/⬇︎Z.Z%, N元”，让您能同时掌握短期波动和中期趋势，并快速判断其对持仓的影响。
    - **交易回顾与即时反馈**: 在趋势信息下方，新增一行展示您最近一笔交易以来的表现，格式为 `X天前 [买入/卖出] [⬆︎/⬇︎]Y.YY% [👍/👎]`。
    - **智能评价**: 系统会自动为您评估这笔操作的“好坏”。👍 代表“正确”的操作（买入后上涨，卖出后下跌），👎 代表“错误”的操作（买入后上涨，卖出后上涨），为您提供即时的决策反馈。
- **趋势强度高亮**: 主列表中的名称单元格会在以下情况自动以浅灰色背景高亮显示：1. 近期趋势跌幅超过 -4.5%（深跌预警）；2. 近期趋势涨幅在 0% 至 4.5% 之间（温和上涨）。
- **净值分位点**: 自动计算最新净值在选定历史周期内的百分比位置，并以“分位点”的形式展示。
- **集成的控制面板**: 在表格上方，提供了一个集中的控制区域，允许用户自由选择排序标准、排序方式、查看的历史记录数量以及调整趋势线的灵敏度。现在，这里还会实时显示您所有持仓基金的**今日预估总盈亏**和**加权平均收益率**。此外，当存在交易记录时，这里还会显示全局的“造成盈亏”和“操作效果”指标，这是对您所有交易操作最终效果的宏观总结，与“持仓切片分析”表格中的汇总行保持一致。
- **实时估值与自动刷新**: 应用会在**启动时**、**手动刷新时**以及**在周一至周五的交易时段（上午9点至下午4点）每 3 分钟自动刷新**时更新所有基金的实时估值，确保信息最新。所有刷新操作（手动或自动）都会同步更新隐私遮罩上的时间戳。为了应对不稳定的网络或 API 服务，刷新逻辑内置了强大的容错机制：当获取某支基金的最新净值失败时，应用将**自动展示上一次成功获取的缓存数据**，从而彻底避免了界面显示空白或错误。对于首次获取失败的请求，系统会进行**一次静默重试**；若重试仍失败，则会继续展示旧数据并在控制台输出警告，等待下一个刷新周期。
- **深度刷新**: **长按刷新按钮 3 秒**，可以强制重新加载所有基金的**全部历史数据**（基于当前选定的“数据范围”），这在您怀疑历史数据不完整或需要进行深度回溯分析时非常有用。
- **详情弹窗视图**: 双击任意基金，即可打开一个功能强大的详细信息弹窗，不仅包含更清晰的性能图表，还是您管理个人持仓的核心界面。
- **基金管理**: 在详情弹窗中可以方便地移除不再需要跟踪的基金，并有二次确认步骤防止误删。
- **响应式设计**: 界面针对桌面和移动设备进行了优化。

## 如何使用

1.  **添加基金**: 在页面底部的“基金代码”输入框中输入一个有效的6位基金代码，然后点击“添加基金”按钮。
2.  **录入持仓**: 双击您刚添加的基金行，打开详情弹窗。在弹窗底部的表单中，输入您的**份额**、**成本价**等
