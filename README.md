
# 基金趋势可视化与持仓管理工具

一款交互式的 Web 应用，旨在帮助用户跟踪、可视化、比较多支投资基金的历史表现，并管理个人持仓信息。

## 核心功能

- **[交互增强] 图表十字对齐引导 (Crosshair Guides)**:
    - **趋势起始锚点**: 自动在 Zigzag 的最后一个转折点（当前趋势的起点）显示一组**灰色虚线十字**。这为观察当前波段的起跌/起涨位置提供了直观的静态基准。
    - **悬停对齐预览**: 鼠标在基金趋势图上滑动时，会自动出现**水平和垂直**的灰色虚线。垂直线对齐日期，水平线对齐当前点净值，作为视觉上的十字对齐参考，帮助精准观察数据（光标保持常规样式）。
    - **点击锚定十字**: 点击图表中的任意点，将锁定一组持久的蓝色粗虚线十字。这使用户能以特定历史点为基准坐标系，直观观察其他日期的净值波动相对于该基准点在时间（X轴）和价格（Y轴）上的双重关系。
- **[UI 优化] 交易历史深度量化**:
    - **策略视角切换**: 在交易历史表格上方新增“计算原始持仓”复选框（默认不勾选）。
        - **不勾选时**: 表头汇总仅反映用户在初始持仓之后的显式操作表现，浮盈和金额的分母精准锁定在后续买入操作上，且“原始持仓”行将灰化显示，帮助用户专注评估主动择时策略的效果。
        - **勾选后**: 汇总数据将全周期覆盖，包含账户的初始状态，提供整体投资回报的宏观视图。
    - **财务逻辑修正**: 优化了现金分红的会计逻辑，将其从“资金投入”修正为“资金回流”。现金分红现在会正确地从“金额/分红”汇总中扣除，从而更真实地反映账户的净资本风险（Net Capital at Risk）。
    - **切片逻辑深度修正**:
        - **全口径浮盈**: 将“红利再投”产生的份额增量价值正式纳入切片分析的“浮盈”统计，确保复利贡献在波动捕获中可见。
        - **稳定分母模型**: 引入 `totalDailyActionValue` 作为行级百分比计算的基准。该分母由当日所有买入、卖出、现金分红和红利再投的绝对市场价值组成。这解决了在纯分红日（现金流变动为0）导致的操作收益百分比显示“未定义”的问题。
        - **汇总百分比逻辑**: 修正了切片分析表头汇总百分比的分母逻辑。**表头汇总百分比的分母现在等于“操作金额”汇总的绝对值**（若为0则回退至总成交额），这使得“操作收益”和“造成盈亏”的百分比更能直观地反映每一元净投入所带来的择时增益或每日盈利能力变动。
        - **明细下钻增强**: 在切片分析的双击明细弹窗中，为买入和卖出表格同步新增了“造成今日盈亏”列。这一指标量化了该笔特定交易份额对今日账户整体盈亏的贡献程度，实现了从组合视角到单笔交易贡献的穿透分析。
        - **高精度率值显示**: 将持仓切片分析表格中的“累计收益率”和“日收益率”显示精度提升至**小数点后 4 位**，为高频操作和细微波动的量化复盘提供更精确的数据支持。
        - **渲染健壮性**: 修复了 React 模板字符串对 `undefined` 的默认处理，确保百分比列即使在极端情况下也显示为 `0.0%` 或 `-`，维护界面专业感。
    - **无感布局适配**: 详情弹窗调整为 `max-w-4xl` 布局，并移除了交易历史表格的横向滚动限制与表头强制不换行限制。内容现在根据容器宽度自然排布，配合表头自动折行机制，实现了在紧凑空间下的信息密度与可读性的平衡。
    - **新增“造成今日盈亏”**: 在交易历史中引入与基金切片一致的“造成盈亏”量化指标。计算每笔交易份额对今日账户盈利能力的贡献（即：`(今日净值 - 昨日净值) * 该笔交易份额`），帮助用户识别哪些历史加减仓决策直接导致了今日的收益波动。
    - **精准汇总占比**: 优化了交易历史表头的百分比计算逻辑：浮盈的分母精准锚定为正向现金流总和（初始成本+买入），机会收益与落袋收益的分母锚定为反向现金流总和（卖出+分红）的绝对值，使择时效果的量化更具财务参考价值。
    - **原始持仓追溯**: 在交易历史表格底部新增“原始持仓”行，作为账户初始状态的锚点。该行数据（份额、成本、浮盈）已无缝集成至表头的汇总统计中，确保复盘数据完整闭环。
    - **单行盈亏占比**: 在基金详情的交易历史表格中，为每一笔交易的“浮盈”、“机会收益”和“落袋收益”新增了相对于该笔交易金额（或分红金额）的百分比显示（如 `+86|1.1%`），帮助用户直观评估每一笔操作的择时质量。
    - **无缝表头吸顶**: 优化了基金详情弹窗中交易历史表格的 `sticky` 布局，移除了滚动容器的顶部偏移，使表头在滚动时能够严丝合缝地贴合弹窗顶部 Header。
- **[UI 优化] 隐私遮罩图表顶格显示**:
    - **暗黑模式适配 (最终版)**: 采用“高对比度实色板”逻辑，确保在所有主题下均有极致的清晰度。
    - **指数级颜色衰减**: 隐私模式下的历史数据线透明度遵循 **指数级衰减逻辑**，营造清晰的视觉透视。
- **[收盘持久化] 完整行情存储**:
    - 每天 15:00 收盘后，系统将自动把包含 **09:15-15:00** 完整波动的数据保存至 `localStorage`。
- **[多端同步] Master-Slave 主从协商机制**:
    - **设备唯一性**: 每台设备生成唯一 UUID。
    - **主机锁 (Lease)**: 通过 Gist 的 `sync_metadata.json` 实现分布式锁。最后一次开启“自动同步”的设备成为 **Master**，拥有云端推送权。
    - **自动退化**: 其他设备在刷新页面时，若发现 Master ID 不匹配，会自动关闭 `AUTO_SYNC_ENABLED` 变为 **Slave**，防止误覆盖数据，确保多端同步的安全性。
- **[数据中继] 大盘历史同步**:
    - **无感 Pull**: 启动或刷新时，自动从公共 Gist 拉取最新的大盘历史（`market_history.json`）并与本地合并。
    - **自动 Push**: 每日 15:00 收盘后，首台完成数据采集的设备将自动把最新的历史曲线推送到云端，实现跨设备的大盘走势接力。

## 隐藏功能

- **报告 (禅定) 模式**:
    - **进入方法**: 在 URL 后添加参数 `?report=true`（例如：`https://your-app.com/?report=true`）。
    - **行为**: 开启后，应用将进入“锁定”状态，仅在屏幕正中央显示当日组合的总收益金额及收益率。**界面文字不可选中**，没有任何按钮、边框、多余信息，适合长期挂机观察或极致沉浸。底部会显示同步的最后更新时间。**支持双击页面空白区域刷新数据**。
    - **退出方法**: 该模式会持久化在 `localStorage` 中。要退出此模式，需打开浏览器控制台执行 `localStorage.removeItem('GINOS_REPORT_MODE')` 并刷新页面。
